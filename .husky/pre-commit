#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# ==== Write-protect shared errors ====
CHANGED=$(git diff --cached --name-only -- packages/shared-types/src/errors.ts packages/shared-types/src/validation.ts)
if [ -n "$CHANGED" ]; then
  echo "â›” errors.ts / validation.ts ã¯ç›´æ¥ç·¨é›†ç¦æ­¢ã€‚yarn gen:error ã‚’ä½¿ã£ã¦ä¸‹ã•ã„ã€‚" >&2
  exit 1
fi

# ==== TODO/FIXME/XXXæ¤œæŸ» ====
if git diff --cached | grep -E "(TODO|FIXME|XXX):" > /dev/null; then
  echo "âŒ TODO/FIXME/XXXãŒæ®‹ã£ã¦ã„ã¾ã™" >&2
  exit 1
fi

# ==== Auto-format and lint staged files ====
echo "ğŸ¨ Formatting and linting staged files..."
yarn lint-staged

# Check if lint-staged failed
if [ $? -ne 0 ]; then
  echo "âŒ Lint-staged failed. Please fix the issues before committing."
  exit 1
fi

echo "âœ… Pre-commit checks passed!"