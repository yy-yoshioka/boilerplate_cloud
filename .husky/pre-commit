#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ==== Write-protect shared errors ====
# åˆå›ä½œæˆæ™‚ã¯é™¤å¤–
if [ ! -f packages/shared-types/src/errors.ts ] || [ ! -f packages/shared-types/src/validation.ts ]; then
  echo "ğŸ“ Initial creation of protected files detected, allowing..."
else
  CHANGED=$(git diff --cached --name-only -- packages/shared-types/src/errors.ts packages/shared-types/src/validation.ts)
  if [ -n "$CHANGED" ]; then
    echo "â›” errors.ts / validation.ts ã¯ç›´æ¥ç·¨é›†ç¦æ­¢ã€‚yarn gen:error ã‚’ä½¿ã£ã¦ä¸‹ã•ã„ã€‚" >&2
    exit 1
  fi
fi

# ==== TODOæ¤œæŸ» ====
git diff --cached | grep -q "TODO:" && echo "âŒ TODOãŒæ®‹ã£ã¦ã„ã¾ã™" && exit 1

echo "ğŸ” Running pre-commit checks..."

# lint-stagedã‚’å®Ÿè¡Œï¼ˆå¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ãƒã‚§ãƒƒã‚¯ï¼‰
npx lint-staged

# lint-stagedãŒå¤±æ•—ã—ãŸå ´åˆ
if [ $? -ne 0 ]; then
  echo "âŒ Lint-staged failed. Please fix the issues before committing."
  exit 1
fi

echo "âœ… Pre-commit checks passed!"