#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."

# ãƒ–ãƒ©ãƒ³ãƒä¿è­·
branch=$(git rev-parse --abbrev-ref HEAD)
if [ "$branch" = "main" ] || [ "$branch" = "master" ]; then
  echo "âš ï¸  Warning: Pushing directly to $branch branch!"
  echo "   Consider creating a feature branch for better code review."
  echo ""
  # è­¦å‘Šã®ã¿ã§ã€pushã¯è¨±å¯ã™ã‚‹
fi

# å‹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
echo "ğŸ“˜ Running type check..."
yarn type-check
if [ $? -ne 0 ]; then
  echo "âŒ Type check failed! Please fix type errors before pushing."
  echo "ğŸ’¡ Tip: Run 'yarn type-check' to see all errors."
  exit 1
fi

# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
echo "ğŸ§ª Running unit tests..."
yarn test
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed! Please fix failing tests before pushing."
  echo "ğŸ’¡ Tip: Run 'yarn test' to see failing tests."
  exit 1
fi

# ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ
echo "ğŸ› ï¸  Running production build..."
yarn build
if [ $? -ne 0 ]; then
  echo "âŒ Build failed! Please fix build errors before pushing."
  echo "ğŸ’¡ Tip: Run 'yarn build' to see build errors."
  exit 1
fi

echo "âœ… All checks passed! Pushing to remote..."